<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Montserrat:wght@400;700&family=Orbitron:wght@400;700&family=Oswald:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #050b18; --txt: #fff; --accent: #3a86ff; --font: 'Roboto', sans-serif; }
        body { margin: 0; padding: 0; font-family: var(--font); background: var(--bg); color: var(--txt); transition: 0.3s; overflow-x: hidden; }
        
        #stars-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); }
        .screen { display: none; padding: 20px; min-height: 100vh; box-sizing: border-box; flex-direction: column; align-items: center; }
        .active { display: flex; }
        
        .btn { background: var(--accent); color: #fff; border: none; padding: 16px; border-radius: 12px; font-size: 16px; width: 100%; max-width: 400px; margin-bottom: 12px; cursor: pointer; font-weight: bold; }
        .top-bar { display: flex; justify-content: space-between; width: 100%; max-width: 400px; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 15px; margin-bottom: 20px; backdrop-filter: blur(10px); cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }
        .theory-card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; margin-bottom: 20px; width: 100%; box-sizing: border-box; backdrop-filter: blur(10px); }
        
        /* –î–ò–ó–ê–ô–ù –°–ï–ö–¢–û–†–û–í */
        body.class-5 { --accent: #84fab0; --bg: #0b2e13; --font: 'Nunito'; }
        body.class-6 { --accent: #651FFF; --bg: #1a0b2e; --font: 'Montserrat'; }
        body.class-7 { --accent: #d60270; --bg: #050511; --font: 'Orbitron'; }
        body.class-8 { --accent: #FFD600; --bg: #000; --txt: #fff; --font: 'Oswald'; }
        body.class-8 .btn { color: #000; border: 2px solid #000; box-shadow: 4px 4px 0 #FFD600; }

        .katex-display { overflow-x: auto; text-align: left !important; font-size: 1.2em; }
    </style>
</head>
<body>
    <div id="stars-canvas"></div>

    <div id="screen-welcome" class="screen active">
        <h1>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è</h1>
        <input type="text" id="username-input" placeholder="–ò–º—è –∫—É—Ä—Å–∞–Ω—Ç–∞...">
        <h3>–°–µ–∫—Ç–æ—Ä –æ–±—É—á–µ–Ω–∏—è:</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width:100%; max-width:400px;">
            <button class="btn" onclick="selectClass(5)">5 –∫–ª–∞—Å—Å</button>
            <button class="btn" onclick="selectClass(6)">6 –∫–ª–∞—Å—Å</button>
            <button class="btn" onclick="selectClass(7)">7 –∫–ª–∞—Å—Å</button>
            <button class="btn" onclick="selectClass(8)">8 –∫–ª–∞—Å—Å</button>
            <button class="btn" onclick="selectClass(9)">9 –∫–ª–∞—Å—Å</button>
            <button class="btn" onclick="selectClass(10)">10 –∫–ª–∞—Å—Å</button>
            <button class="btn" style="grid-column: span 2" onclick="selectClass(11)">11 –∫–ª–∞—Å—Å</button>
        </div>
        <button class="btn" style="margin-top:20px; background:#555;" onclick="openExternalFeedback()">üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</button>
    </div>

    <div id="screen-menu" class="screen">
        <div class="top-bar" onclick="showScreen('screen-shop')">
            <div>‚ù§Ô∏è <span id="lives-display">5</span></div>
            <div style="color: gold; font-weight:bold;">ü™ô <span id="coins-display">0</span></div>
        </div>
        <h1 id="welcome-text"></h1>
        <div style="width:100%; max-width:400px;">
            <button class="btn" onclick="showTheorySelection()">üìö –¢–µ–æ—Ä–∏—è (7 –±–ª–æ–∫–æ–≤)</button>
            <button class="btn" onclick="startPractice()">‚úèÔ∏è –ü—Ä–∞–∫—Ç–∏–∫–∞</button>
            <button class="btn" onclick="showScreen('screen-shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="btn" style="background:#c0392b" onclick="openExternalFeedback()">‚ö†Ô∏è –°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ</button>
            <button class="btn" style="background:transparent; border:1px solid #444" onclick="location.reload()">‚Ü© –°–º–µ–Ω–∏—Ç—å –∫–ª–∞—Å—Å</button>
        </div>
    </div>

    <div id="screen-theory-select" class="screen">
        <div class="top-bar" onclick="showScreen('screen-menu')">‚¨Ö –ù–∞–∑–∞–¥</div>
        <h2>7 –°–µ–∫—Ç–æ—Ä–æ–≤ —Ç–µ–æ—Ä–∏–∏</h2>
        <div id="topics-list" style="width:100%; max-width:400px;"></div>
    </div>

    <div id="screen-theory-read" class="screen">
        <div class="top-bar" onclick="showTheorySelection()">‚¨Ö –ù–∞–∑–∞–¥</div>
        <div id="theory-content" class="theory-card"></div>
        <button class="btn" onclick="startPractice()">–ü—Ä–æ–π—Ç–∏ –ø—Ä–∞–∫—Ç–∏–∫—É</button>
    </div>

    <div id="screen-practice" class="screen">
        <div class="top-bar" onclick="showScreen('screen-shop')">‚ù§Ô∏è <span id="quiz-lives">5</span> | ü™ô <span id="quiz-coins">0</span></div>
        <div class="theory-card"><h3 id="question-text">–°–≤—è–∑—å —Å–æ —Å–ø—É—Ç–Ω–∏–∫–æ–º...</h3></div>
        <div id="answers-block" style="width:100%; max-width:400px;"></div>
        <div id="feedback-block" style="display:none; padding:15px; background:rgba(255,255,255,0.95); border-radius:10px; color:#000; width:100%; max-width:400px; flex-direction:column; align-items:center;">
            <strong id="feedback-title"></strong>
            <p id="feedback-solution" style="margin: 10px 0; font-size:16px;"></p>
            <button class="btn" id="next-q-btn">–î–∞–ª–µ–µ ‚û°</button>
        </div>
    </div>

    <div id="screen-shop" class="screen">
        <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
        <p>–ë–∞–ª–∞–Ω—Å: <span id="shop-balance" style="color:gold;">0</span> ü™ô</p>
        <div id="shop-items" style="width:100%; max-width:400px;"></div>
        <button class="btn" style="background:#7f8c8d" onclick="showScreen('screen-menu')">üè† –ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-error-proposal" class="screen">
        <h1>–ú–∏—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h1>
        <div class="theory-card">
            <p id="error-summary"></p>
            <p>–•–æ—Ç–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∏ –ø—Ä–æ–π—Ç–∏ –∑–∞–¥–∞—á–∏ –ø–æ —ç—Ç–∏–º —Ç–µ–º–∞–º –∑–∞–Ω–æ–≤–æ?</p>
        </div>
        <button class="btn" onclick="startErrorCorrection()">‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏</button>
        <button class="btn" style="background:#7f8c8d" onclick="showScreen('screen-menu')">üè† –í –º–µ–Ω—é</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp; tg.expand();
        function createStars() { const c = document.getElementById('stars-canvas'); for (let i = 0; i < 70; i++) { const s = document.createElement('div'); s.className = 'star'; const size = Math.random() * 3 + 'px'; s.style.width = size; s.style.height = size; s.style.left = Math.random() * 100 + '%'; s.style.top = Math.random() * 100 + '%'; s.style.animationDelay = Math.random() * 5 + 's'; c.appendChild(s); } } createStars();

        const theoryData = {
            5: [
                { title: "1. –ß–∏—Å–ª–∞ –∏ –¥–µ–π—Å—Ç–≤–∏—è", content: String.raw`a+b=b+a \\ (a+b)+c=a+(b+c) \\ a \cdot (b+c)=ab+ac \\ a \cdot 1=a, a \cdot 0=0 \\ a:1=a, a:a=1 \\ a \cdot b = b \cdot a \\ a:b=q \text{ (–æ—Å—Ç. } r)` },
                { title: "2. –ì–µ–æ–º–µ—Ç—Ä–∏—è 5 –∫–ª", content: String.raw`P = 2(a+b) \\ P = 4a \\ S = ab \\ S = a^2 \\ V = abc \\ V = a^3 \\ S_{–ø–æ–≤} = 6a^2` },
                { title: "3. –ó–∞–¥–∞—á–∏ –Ω–∞ –¥–≤–∏–∂–µ–Ω–∏–µ", content: String.raw`s = v \cdot t \\ v = s/t \\ t = s/v \\ v_{–ø–æ} = v_{—Å–æ–±} + v_{—Ç–µ—á} \\ v_{–ø—Ä} = v_{—Å–æ–±} - v_{—Ç–µ—á} \\ v_{—Å–±–ª} = v_1 + v_2 \\ v_{—É–¥} = v_1 - v_2` },
                { title: "4. –û–±—ã–∫–Ω–æ–≤–µ–Ω–Ω—ã–µ –¥—Ä–æ–±–∏", content: String.raw`\frac{a}{c} + \frac{b}{c} = \frac{a+b}{c} \\ \frac{a}{c} - \frac{b}{c} = \frac{a-b}{c} \\ \frac{a}{a} = 1 \\ \frac{0}{b} = 0 \\ n \cdot \frac{a}{b} = \text{—á–∞—Å—Ç—å} \\ m : \frac{a}{b} = \text{—Ü–µ–ª–æ–µ} \\ a\frac{b}{c} = \frac{ac+b}{c}` },
                { title: "5. –î–µ—Å—è—Ç–∏—á–Ω—ã–µ –¥—Ä–æ–±–∏", content: String.raw`a,b + c,d \\ a,b \cdot 10^n \to \text{–≤–ø—Ä–∞–≤–æ} \\ a,b : 10^n \to \text{–≤–ª–µ–≤–æ} \\ \text{–°—Ä–µ–¥–Ω–µ–µ: } \frac{\sum x}{n} \\ a,b \cdot c,d \\ a,b : c,d \\ 5 \uparrow, 4 \downarrow` },
                { title: "6. –ü—Ä–æ—Ü–µ–Ω—Ç—ã", content: String.raw`1\% = 0,01 \\ 100\% = 1 \\ 50\% = 1/2 \\ 25\% = 1/4 \\ 10\% = 0,1 \\ 20\% = 0,2 \\ n \cdot \frac{p}{100}` },
                { title: "7. –ò–∑–º–µ—Ä–µ–Ω–∏—è", content: String.raw`1 \text{ –∫–º} = 1000 \text{ –º} \\ 1 \text{ –º} = 100 \text{ —Å–º} \\ 1 \text{ –∫–≥} = 1000 \text{ –≥} \\ 1 \text{ —Ç} = 1000 \text{ –∫–≥} \\ 1 \text{ –≥–∞} = 10000 \text{ –º}^2 \\ 1 \text{ —Ü} = 100 \text{ –∫–≥} \\ 1 \text{ –ª} = 1 \text{ –¥–º}^3` }
            ],
            6: [
                { title: "1. –î–µ–ª–∏–º–æ—Å—Ç—å", content: String.raw`a = bk \\ \text{–ù–û–î} \cdot \text{–ù–û–ö} = ab \\ \text{–ü—Ä–∏–∑–Ω–∞–∫ 2: —á–µ—Ç–Ω—ã–µ} \\ \text{–ü—Ä–∏–∑–Ω–∞–∫ 3: } \sum cif : 3 \\ \text{–ü—Ä–∏–∑–Ω–∞–∫ 5: 0, 5} \\ \text{–ü—Ä–∏–∑–Ω–∞–∫ 9: } \sum cif : 9 \\ \text{–ü—Ä–∏–∑–Ω–∞–∫ 10: 0}` },
                { title: "2. –î—Ä–æ–±–∏", content: String.raw`\frac{a}{b} = \frac{ac}{bc} \\ \frac{a}{b} \cdot \frac{c}{d} = \frac{ac}{bd} \\ \frac{a}{b} : \frac{c}{d} = \frac{ad}{bc} \\ x \cdot \frac{1}{x} = 1 \\ \frac{a}{b} \pm \frac{c}{d} = \frac{ad \pm bc}{bd} \\ a^1 = a \\ (a/b)^n = a^n/b^n` },
                { title: "3. –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏", content: String.raw`a:b = c:d \\ ad = bc \\ a = bc/d \\ b = ad/c \\ k = a/b \\ \text{–ú–∞—Å—à—Ç–∞–±: } L_m/L_r \\ y=kx` },
                { title: "4. –ö—Ä—É–≥ –∏ –û–∫—Ä—É–∂–Ω–æ—Å—Ç—å", content: String.raw`d = 2r \\ C = \pi d \\ C = 2\pi r \\ S = \pi r^2 \\ \pi \approx 3,14 \\ \text{–î–ª–∏–Ω–∞ –¥—É–≥–∏: } \frac{\pi r \alpha}{180} \\ \text{–°–µ–∫—Ç–æ—Ä: } \frac{\pi r^2 \alpha}{360}` },
                { title: "5. –¶–µ–ª—ã–µ —á–∏—Å–ª–∞", content: String.raw`|a| = a, -a \\ -a-b = -(a+b) \\ a-b = a+(-b) \\ -a \cdot (-b) = ab \\ -a \cdot b = -ab \\ -a:(-b) = a/b \\ a:(-b) = -a/b` },
                { title: "6. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã", content: String.raw`A(x; y) \\ \text{OX - –∞–±—Å—Ü–∏—Å—Å} \\ \text{OY - –æ—Ä–¥–∏–Ω–∞—Ç} \\ \text{–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: } |x_2-x_1| \\ \text{I: (+;+)} \\ \text{II: (-;+)} \\ \text{III: (-;-)}` },
                { title: "7. –£—Ä–∞–≤–Ω–µ–Ω–∏—è", content: String.raw`a+(b-c)=a+b-c \\ a-(b-c)=a-b+c \\ a(b+c)=ab+ac \\ x+a=b \to x=b-a \\ ax=b \to x=b/a \\ a \to -a \\ 2x+3x=5x` }
            ],
            7: [
                { title: "1. –õ–∏–Ω–µ–π–Ω—ã–µ —É—Ä-—è", content: String.raw`ax=b \\ x=b/a \quad (a \neq 0) \\ 0x=0 \to \infty \\ 0x=b \to \emptyset \\ ax+b=c \\ x=a \Leftrightarrow kx=ka \\ f(x)=y` },
                { title: "2. –°–≤–æ–π—Å—Ç–≤–∞ —Å—Ç–µ–ø–µ–Ω–µ–π", content: String.raw`a^n \cdot a^m = a^{n+m} \\ a^n : a^m = a^{n-m} \\ (a^n)^m = a^{nm} \\ (ab)^n = a^n b^n \\ (a/b)^n = a^n/b^n \\ a^0 = 1 \\ a^1 = a` },
                { title: "3. –ú–Ω–æ–≥–æ—á–ª–µ–Ω—ã", content: String.raw`a(b+c)=ab+ac \\ (a+b)(c+d)=ac+ad+bc+bd \\ \text{–°—Ç–∞–Ω–¥–∞—Ä—Ç: } ax^n \\ \text{–°—Ç–µ–ø–µ–Ω—å: } \sum n_i \\ \text{–í—ã–Ω–æ—Å –∑–∞ —Å–∫–æ–±–∫–∏} \\ \text{–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞} \\ (a+b)+(c+d)` },
                { title: "4. –ö–≤–∞–¥—Ä–∞—Ç—ã (–§–°–£)", content: String.raw`(a \pm b)^2 = a^2 \pm 2ab+b^2 \\ a^2-b^2 = (a-b)(a+b) \\ (-a-b)^2 = (a+b)^2 \\ (a-b)^2 = (b-a)^2 \\ x^2+2x+1 = (x+1)^2 \\ 4x^2-9 = (2x-3)(2x+3) \\ \text{–í—ã–¥–µ–ª–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–∞}` },
                { title: "5. –ö—É–±—ã (–§–°–£)", content: String.raw`(a \pm b)^3 = a^3 \pm 3a^2b+3ab^2 \pm b^3 \\ a^3 \pm b^3 = (a \pm b)(a^2 \mp ab+b^2) \\ \text{–†–∞–∑–Ω–æ—Å—Ç—å –∫—É–±–æ–≤} \\ \text{–°—É–º–º–∞ –∫—É–±–æ–≤} \\ \text{–ö—É–± —Ä–∞–∑–Ω–æ—Å—Ç–∏} \\ \text{–ö—É–± —Å—É–º–º—ã} \\ \text{–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞}` },
                { title: "6. –§—É–Ω–∫—Ü–∏–∏", content: String.raw`y=kx+b \\ k \text{ - –Ω–∞–∫–ª–æ–Ω} \\ b \text{ - —Å–¥–≤–∏–≥ OY} \\ k_1=k_2 \to \parallel \\ y=kx \to (0;0) \\ y=b \to \text{–≥–æ—Ä–∏–∑–æ–Ω—Ç} \\ \text{–¢–æ—á–∫–∞: } (x; y)` },
                { title: "7. –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏", content: String.raw`Sum \angle = 180^\circ \\ \text{–ü—Ä–∏–∑–Ω–∞–∫–∏: –°–£–°, –£–°–£, –°–°–°} \\ \text{–ë–∏—Å—Å–µ–∫—Ç—Ä–∏—Å–∞: } 1=2 \\ \text{–ú–µ–¥–∏–∞–Ω–∞: } 1=2 \\ \angle_{–≤–Ω–µ—à} = \sum \angle_{–Ω–µ\_—Å–º–µ–∂} \\ a+b > c \\ \text{–†–∞–≤–Ω–æ–±–µ–¥—Ä: } \alpha = \beta` }
            ],
            8: [
                { title: "1. –†–∞—Ü. –¥—Ä–æ–±–∏", content: String.raw`\frac{A}{B} \pm \frac{C}{D} = \frac{AD \pm BC}{BD} \\ \frac{A}{B} \cdot \frac{C}{D} = \frac{AC}{BD} \\ \frac{A}{B} : \frac{C}{D} = \frac{AD}{BC} \\ \frac{A}{B} = \frac{AK}{BK} \\ -\frac{a}{b} = \frac{-a}{b} \\ B \neq 0 \\ \text{–§–°–£ –≤ –¥—Ä–æ–±—è—Ö}` },
                { title: "2. –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –∫–æ—Ä–Ω–∏", content: String.raw`\sqrt{a^2} = |a| \\ \sqrt{ab} = \sqrt{a}\sqrt{b} \\ \sqrt{a/b} = \sqrt{a}/\sqrt{b} \\ (\sqrt{a})^2 = a \\ \sqrt{a^{2n}} = a^n \\ a < b \Rightarrow \sqrt{a} < \sqrt{b} \\ \frac{1}{\sqrt{a}} = \frac{\sqrt{a}}{a}` },
                { title: "3. –ö–≤. —É—Ä–∞–≤–Ω–µ–Ω–∏—è", content: String.raw`ax^2+bx+c=0 \\ D = b^2-4ac \\ x = \frac{-b \pm \sqrt{D}}{2a} \\ x_1+x_2 = -b/a \\ x_1x_2 = c/a \\ ax^2+bx+c = a(x-x_1)(x-x_2) \\ x^2=a \to \pm\sqrt{a}` },
                { title: "4. –ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞", content: String.raw`a>b, c>0 \to ac>bc \\ a>b, c<0 \to ac<bc \\ |x|<a \to -a<x<a \\ |x|>a \to x<-a \cup x>a \\ a>b, c>d \to a+c > b+d \\ \text{–ú–µ—Ç–æ–¥ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤} \\ \text{–°–∏—Å—Ç–µ–º–∞: } \cap` },
                { title: "5. –°—Ç–µ–ø–µ–Ω—å –∏ –í–∏–¥", content: String.raw`a^{-n} = 1/a^n \\ (a/b)^{-n} = (b/a)^n \\ a \cdot 10^n \quad (1 \le a < 10) \\ 10^{-k} = 0,00..1 \\ a^n a^m = a^{n+m} \\ (a^n)^m = a^{nm} \\ a^n : a^m = a^{n-m}` },
                { title: "6. –ß–µ—Ç—ã—Ä–µ—Ö—É–≥–æ–ª—å–Ω–∏–∫–∏", content: String.raw`S_{–ø–∞—Ä} = ah = ab \sin \alpha \\ S_{—Ä–æ–º–±} = 0,5 d_1 d_2 \\ S_{—Ç—Ä–∞–ø} = \frac{a+b}{2}h \\ S_{–ø—Ä—è–º} = ab \\ S_{–∫–≤} = a^2 \\ \angle 1+\angle 2 = 180^\circ \\ d_1 \perp d_2 \text{ (—Ä–æ–º–±)}` },
                { title: "7. –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏", content: String.raw`a^2+b^2=c^2 \\ \sin = a/c \\ \cos = b/c \\ tg = a/b \\ \sin^2 + \cos^2 = 1 \\ S = 0,5 ab \sin \gamma \\ S = pr` }
            ],
            9: [
                { title: "1. –ö–≤. —Ñ—É–Ω–∫—Ü–∏—è", content: String.raw`y = ax^2+bx+c \\ x_0 = -b/2a \\ y_0 = f(x_0) \\ a>0 \uparrow, a<0 \downarrow \\ c = f(0) \\ D>0 \to 2 \text{ –∫–æ—Ä–Ω—è} \\ D=0 \to 1 \text{ –∫–æ—Ä–µ–Ω—å}` },
                { title: "2. –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–∏", content: String.raw`a_n = a_1+d(n-1) \\ S_n = \frac{a_1+a_n}{2}n \\ b_n = b_1 q^{n-1} \\ S_n = \frac{b_1(q^n-1)}{q-1} \\ S = \frac{b_1}{1-q} \\ d = a_2-a_1 \\ q = b_2/b_1` },
                { title: "3. –°–∏–Ω—É—Å—ã/–ö–æ—Å–∏–Ω—É—Å—ã", content: String.raw`a^2 = b^2+c^2-2bc \cos A \\ \frac{a}{\sin A} = \frac{b}{\sin B} = 2R \\ \sin(180-x) = \sin x \\ \cos(180-x) = -\cos x \\ S = 0,5 ab \sin C \\ S = \sqrt{p(p-a)(p-b)(p-c)} \\ R = \frac{abc}{4S}` },
                { title: "4. –í–µ–∫—Ç–æ—Ä—ã", content: String.raw`|\vec{a}| = \sqrt{x^2+y^2} \\ \vec{a} \cdot \vec{b} = x_1x_2+y_1y_2 \\ \vec{a} \cdot \vec{b} = |\vec{a}||\vec{b}| \cos \alpha \\ \vec{a}+\vec{b} = (x_1+x_2; y_1+y_2) \\ k\vec{a} = (kx; ky) \\ \vec{a} \perp \vec{b} \to \vec{a}\vec{b}=0 \\ x_1/x_2 = y_1/y_2` },
                { title: "5. –û–∫—Ä—É–∂–Ω–æ—Å—Ç—å", content: String.raw`(x-x_0)^2+(y-y_0)^2 = R^2 \\ \angle_{–≤–ø–∏—Å} = 0,5 \angle_{—Ü–µ–Ω—Ç—Ä} \\ \angle \text{ –Ω–∞ –¥–∏–∞–º} = 90^\circ \\ \text{–ö–∞—Å } \perp \text{ –†–∞–¥} \\ ab=cd \text{ (—Ö–æ—Ä–¥—ã)} \\ \text{–û—Ç—Ä–µ–∑–∫–∏ –∫–∞—Å. —Ä–∞–≤–Ω—ã} \\ S_{—Å–µ–∫—Ç} = \frac{\pi r^2 \alpha}{360}` },
                { title: "6. n-—É–≥–æ–ª—å–Ω–∏–∫–∏", content: String.raw`Sum \angle = 180(n-2) \\ \alpha_n = \frac{180(n-2)}{n} \\ a_6 = R \\ a_4 = R\sqrt{2} \\ a_3 = R\sqrt{3} \\ S = 0,5 Pr \\ r = a_3 \sqrt{3}/6` },
                { title: "7. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å", content: String.raw`P(A) = m/n \\ P(\bar{A}) = 1-P(A) \\ \text{–ú–µ–¥–∏–∞–Ω–∞} \\ \text{–ú–æ–¥–∞} \\ \text{–†–∞–∑–º–∞—Ö} \\ m/N \text{ (—á–∞—Å—Ç–æ—Ç–∞)} \\ 0 \le P \le 1` }
            ],
            10: [
                { title: "1. –¢—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è", content: String.raw`\sin^2 + \cos^2 = 1 \\ tg \cdot ctg = 1 \\ tg = \sin/\cos \\ ctg = \cos/\sin \\ 1+tg^2 = 1/\cos^2 \\ 1+ctg^2 = 1/\sin^2 \\ \sin(-x) = -\sin x` },
                { title: "2. –§–æ—Ä–º—É–ª—ã", content: String.raw`\sin(a \pm b) = \sin a \cos b \pm \cos a \sin b \\ \cos(a \pm b) = \cos a \cos b \mp \sin a \sin b \\ \sin 2a = 2\sin a \cos a \\ \cos 2a = \cos^2 a - \sin^2 a \\ \cos 2a = 2\cos^2 a - 1 \\ \cos 2a = 1 - 2\sin^2 a \\ tg 2a = \frac{2tg a}{1-tg^2 a}` },
                { title: "3. –£—Ä–∞–≤–Ω–µ–Ω–∏—è", content: String.raw`x = (-1)^k \arcsin a + \pi k \\ x = \pm \arccos a + 2\pi k \\ tg x = a \to arctg a + \pi k \\ \sin x=0 \to \pi k \\ \cos x=0 \to \pi/2+\pi k \\ \sin x=1 \to \pi/2+2\pi k \\ \cos x=1 \to 2\pi k` },
                { title: "4. –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è", content: String.raw`C'=0, x'=1 \\ (x^n)' = nx^{n-1} \\ (\sin x)' = \cos x \\ (\cos x)' = -\sin x \\ (tg x)' = 1/\cos^2 x \\ (e^x)' = e^x \\ (\ln x)' = 1/x` },
                { title: "5. –ü—Ä–∞–≤–∏–ª–∞", content: String.raw`(u \pm v)' = u' \pm v' \\ (uv)' = u'v+uv' \\ (u/v)' = \frac{u'v-uv'}{v^2} \\ (Cu)' = Cu' \\ f(g)' = f'(g)g' \\ v(t) = s'(t) \\ a(t) = v'(t)` },
                { title: "6. –ü—Ä–∏–∑–º—ã", content: String.raw`V = S_{–æ—Å–Ω} h \\ S_{–±–æ–∫} = P_{–æ—Å–Ω} h \\ d^2 = a^2+b^2+c^2 \\ S_{–ø–æ–ª–Ω} = S_{–±–æ–∫} + 2S_{–æ—Å–Ω} \\ \text{–¢–¢–ü} \\ \angle \text{ (–ø—Ä, –ø–ª)} \\ \angle \text{ (–ø–ª, –ø–ª)}` },
                { title: "7. –ü–∏—Ä–∞–º–∏–¥—ã/–ö–æ–Ω", content: String.raw`V = \frac{1}{3} S_{–æ—Å–Ω} h \\ S_{–±–æ–∫} = 0,5 P_{–æ—Å–Ω} l \\ V_{–∫–æ–Ω} = \frac{1}{3} \pi r^2 h \\ S_{–±–æ–∫\_–∫–æ–Ω} = \pi rl \\ l^2 = r^2+h^2 \\ V_{—Ü–∏–ª} = \pi r^2 h \\ S_{–±–æ–∫\_—Ü–∏–ª} = 2\pi rh` }
            ],
            11: [
                { title: "1. –õ–æ–≥–∞—Ä–∏—Ñ–º—ã", content: String.raw`a^{\log_a b} = b \\ \log_a bc = \log_a b + \log_a c \\ \log_a (b/c) = \log_a b - \log_a c \\ \log_a b^n = n \log_a b \\ \log_{a^k} b = \frac{1}{k} \log_a b \\ \log_a b = \frac{\log_c b}{\log_c a} \\ \ln x = \log_e x` },
                { title: "2. –õ–æ–≥. —É—Ä–∞–≤–Ω–µ–Ω–∏—è", content: String.raw`\log_a f = b \to f = a^b \\ \log_a f = \log_a g \to f=g \\ f>0, a>0, a \neq 1 \\ t = \log_a x \\ a^{\log_c b} = b^{\log_c a} \\ \log_a b = 1/\log_b a \\ \log_a 1 = 0` },
                { title: "3. –†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è", content: String.raw`(a-1)(f-g) \gtrless 0 \\ |f|-|g| \to (f-g)(f+g) \\ (h-1)(f-1) \gtrless 0 \\ \sqrt{f}-\sqrt{g} \to f-g \\ \text{–û–î–ó –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ} \\ (f-g)/h \to \text{–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã} \\ a^f - a^g \to (a-1)(f-g)` },
                { title: "4. –û–±—ä–µ–º—ã/S", content: String.raw`V_{—à–∞—Ä} = \frac{4}{3} \pi r^3 \\ S_{—Å—Ñ–µ—Ä–∞} = 4\pi r^2 \\ V_{—Ü–∏–ª} = \pi r^2 h \\ S_{–±–æ–∫} = 2\pi rh \\ V_{–∫–æ–Ω} = \frac{1}{3} \pi r^2 h \\ S_{–±–æ–∫\_–∫–æ–Ω} = \pi rl \\ S_{–ø–æ–ª–Ω} = \pi r(r+l)` },
                { title: "5. –ö–∞—Å–∞—Ç–µ–ª—å–Ω–∞—è/Int", content: String.raw`y = f(x_0) + f'(x_0)(x-x_0) \\ k = tg \alpha = f'(x_0) \\ \int x^n dx = \frac{x^{n+1}}{n+1} \\ \int e^x dx = e^x \\ \int \cos dx = \sin x \\ \int 1/x dx = \ln|x| \\ S = \int_a^b f(x) dx` },
                { title: "6. –≠–∫–æ–Ω–æ–º–∏–∫–∞ –ï–ì–≠", content: String.raw`X = S \frac{k^n(k-1)}{k^n-1} \\ k = 1 + r/100 \\ \text{–î–∏—Ñ—Ñ: } \sum \text{–≤—ã–ø–ª–∞—Ç} \\ \text{–î–æ—Ö–æ–¥} = –í—ã—Ä—É—á - –ó–∞—Ç—Ä \\ f'(x)=0 \to opt \\ S_n = S(1+r/100)^n \\ \text{–ü–µ—Ä–µ–ø–ª–∞—Ç–∞} = \sum P - S` },
                { title: "7. –°–∏—Å—Ç–µ–º—ã –∏ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã", content: String.raw`\begin{cases} x \ge a \\ y = f(x) \end{cases} \\ |z| = \sqrt{a^2+b^2} \\ (x-a)^2+(y-b)^2 = R^2 \\ D>0 \to 2 \\ \text{–°–¥–≤–∏–≥} \\ f(x,a)=0 \\ \text{–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω–æ—Å—Ç—å}` }
            ]
        };

        let state = {
            name: localStorage.getItem('math_user_name') || "",
            class: localStorage.getItem('math_user_class') || 0,
            lives: 5,
            coins: parseInt(localStorage.getItem('math_user_coins')) || 0,
            wrongTopics: [],
            currentQuestions: [], currentQIndex: 0,
            isCorrection: false
        };

        if (state.name) document.getElementById('username-input').value = state.name;

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        function selectClass(cls) {
            const n = document.getElementById('username-input').value;
            if (!n) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
            state.name = n; state.class = cls;
            localStorage.setItem('math_user_name', n);
            localStorage.setItem('math_user_class', cls);
            document.body.className = `class-${cls}`;
            document.getElementById('welcome-text').innerText = `–ö—É—Ä—Å–∞–Ω—Ç ${n}, —Å–µ–∫—Ç–æ—Ä ${cls}`;
            updateStats();
            renderShop();
            showScreen('screen-menu');
        }

        function updateStats() {
            ['lives-display', 'coins-display', 'quiz-lives', 'quiz-coins', 'shop-balance'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerText = id.includes('lives') ? state.lives : state.coins;
            });
            localStorage.setItem('math_user_coins', state.coins);
        }

        function renderShop() {
            const items = [{ name: "–°—Ç–∏–ª—å '–ù–æ–≤–∏—á–æ–∫'", price: 30 }, { name: "–°—Ç–∏–ª—å '–ü—Ä–æ—Ñ–∏'", price: 70 }, { name: "–°—Ç–∞—Ç—É—Å '–õ–µ–≥–µ–Ω–¥–∞'", price: 150 }];
            const cont = document.getElementById('shop-items'); cont.innerHTML = "";
            items.forEach(it => {
                const div = document.createElement('div');
                div.className = "theory-card";
                div.innerHTML = `<strong>${it.name}</strong><br>–¶–µ–Ω–∞: ${it.price} ü™ô`;
                div.onclick = () => {
                    if (state.coins >= it.price) openExternalFeedback();
                    else { alert(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ${it.price - state.coins} –º–æ–Ω–µ—Ç!`); location.reload(); }
                };
                cont.appendChild(div);
            });
        }

        async function startPractice(topics = null) {
            state.lives = 5; state.currentQIndex = 0; state.isCorrection = !!topics;
            showScreen('screen-practice');
            try {
                const res = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vSyYBIArwn-npZYPgPwIazi4HzVR4DzusAc1VvJ_eQklHkYBElS7r0pwZzx-Pe2tPnoop9sFBpFMZWj/pub?output=csv");
                const csv = await res.text();
                const rows = csv.split(/\r?\n/).slice(1).map(l => l.split(','));
                let filtered = rows.filter(r => r[0] && r[0].trim() == state.class.toString());
                if (topics) filtered = filtered.filter(r => topics.includes(r[7]));
                state.currentQuestions = filtered.sort(() => 0.5 - Math.random()).slice(0, state.class <= 7 ? 5 : 10);
                renderQuestion();
            } catch (e) { alert("–°–±–æ–π —Å–≤—è–∑–∏!"); showScreen('screen-menu'); }
        }

        function renderQuestion() {
            document.getElementById('feedback-block').style.display = 'none';
            const q = state.currentQuestions[state.currentQIndex];
            if (!q) return finishQuiz(true);
            
            const qText = document.getElementById('question-text');
            qText.innerHTML = q[1].replace(/\$/g, "");
            renderMathInElement(qText, { delimiters: [{left: "$", right: "$", display: false}, {left: "\\(", right: "\\)", display: false}] });

            const b = document.getElementById('answers-block'); b.innerHTML = "";
            [q[2], q[3], q[4], q[5]].forEach((opt, i) => {
                if (opt && opt.trim()) {
                    const btn = document.createElement('button'); btn.className = "btn";
                    btn.style.background = "#fff"; btn.style.color = "#000";
                    btn.innerHTML = opt.replace(/\$/g, "");
                    renderMathInElement(btn, { delimiters: [{left: "$", right: "$", display: false}, {left: "\\(", right: "\\)", display: false}] });
                    btn.onclick = () => {
                        const corr = parseInt(q[6].replace(/\D/g, ""));
                        document.querySelectorAll('#answers-block .btn').forEach(btn => btn.disabled = true);
                        const fblock = document.getElementById('feedback-block');
                        fblock.style.display = "flex";
                        if (i + 1 === corr) {
                            btn.style.background = "#2ecc71"; state.coins += 10;
                            document.getElementById('feedback-title').innerText = "‚úÖ –í–µ—Ä–Ω–æ!";
                        } else {
                            btn.style.background = "#e74c3c"; state.lives--;
                            state.wrongTopics.push(q[7]);
                            document.getElementById('feedback-title').innerText = "‚ùå –û—à–∏–±–∫–∞!";
                        }
                        const sol = document.getElementById('feedback-solution');
                        sol.innerHTML = q[8].replace(/\$/g, "") || "";
                        renderMathInElement(sol, { delimiters: [{left: "$", right: "$", display: false}, {left: "\\(", right: "\\)", display: false}] });
                        document.getElementById('next-q-btn').onclick = () => {
                            state.currentQIndex++;
                            if (state.lives > 0) renderQuestion(); else finishQuiz(false);
                        };
                        updateStats();
                    }; b.appendChild(btn);
                }
            });
        }

        function startErrorCorrection() {
            const topics = [...new Set(state.wrongTopics)];
            state.wrongTopics = [];
            startPractice(topics);
        }

        function finishQuiz(win) {
            if (state.wrongTopics.length > 0) {
                showScreen('screen-error-proposal');
                document.getElementById('error-summary').innerText = `–ú–∏—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û—à–∏–±–æ–∫: ${state.wrongTopics.length}`;
            } else {
                showScreen('screen-results');
                document.getElementById('result-message').innerText = win ? "–ú–∏—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! üéâ" : "–°–≤—è–∑—å –ø–æ—Ç–µ—Ä—è–Ω–∞ üíÄ";
            }
            updateStats();
        }

        function showTheorySelection() {
            const l = document.getElementById('topics-list'); l.innerHTML = "";
            (theoryData[state.class] || []).forEach((t, idx) => {
                const b = document.createElement('button'); b.className = "btn"; b.innerText = t.title;
                b.onclick = () => {
                    const c = document.getElementById('theory-content');
                    c.innerHTML = `<h3>${t.title}</h3><div id="m"></div>`;
                    katex.render(t.content, document.getElementById('m'), { displayMode: true, throwOnError: false });
                    showScreen('screen-theory-read');
                }; l.appendChild(b);
            }); showScreen('screen-theory-select');
        }

        function openExternalFeedback() { tg.openTelegramLink('https://t.me/supertutor15'); }
    </script>
</body>
</html>